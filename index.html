<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Stats Demo: The Reaction Time Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card {
            @apply bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-lg;
        }
        .btn {
            @apply px-5 py-2.5 rounded-lg font-semibold text-white transition-all duration-200;
        }
        .btn-primary {
            @apply bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed;
        }
        .btn-secondary {
            @apply bg-gray-600 hover:bg-gray-700 disabled:bg-gray-500 disabled:cursor-not-allowed;
        }
        #game-box {
            width: 100%;
            height: 200px;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">The Reaction Time Challenge</h1>
            <p class="text-lg text-blue-300">An Interactive Demo of Statistical Concepts</p>
        </header>

        <main class="space-y-8">
            <!-- Step 1: The Hypothesis -->
            <div class="card">
                <h2 class="text-2xl font-bold text-white mb-3">Step 1: The Big Question & The Null Hypothesis</h2>
                <p class="mb-4">Our question is simple and fun: <strong class="text-yellow-400">Does drinking coffee make your reaction time faster?</strong></p>
                <p>In statistics, we start by assuming the "boring" scenario. We call this the <strong class="text-green-400">Null Hypothesis ($H_0$)</strong>. It's the starting point we try to disprove.</p>
                <div class="bg-gray-900 border border-green-500/30 p-4 rounded-lg mt-4">
                    <p class="text-lg"><strong class="text-green-400">Our Null Hypothesis ($H_0$):</strong> Coffee has <strong class="font-bold">no effect</strong> on reaction time. The average reaction times for coffee drinkers and non-drinkers are the same.</p>
                </div>
                 <p class="mt-4">Our goal is to see if we can collect enough evidence to <strong class="text-red-400">reject</strong> this null hypothesis.</p>
            </div>

            <!-- Step 2: Data Collection -->
            <div class="card">
                <h2 class="text-2xl font-bold text-white mb-3">Step 2: Let's Collect Some Data!</h2>
                <p class="mb-4">Click the buttons below to test your reaction time. You'll perform 5 trials for each condition. When the red box turns green, click it as fast as you can!</p>
                
                <div id="game-box" class="bg-gray-700 rounded-lg flex items-center justify-center text-xl font-bold transition-colors duration-100">
                    <span id="game-text">Ready to Play?</span>
                </div>

                <div class="flex flex-col sm:flex-row gap-4 mt-4">
                    <button id="start-no-coffee" class="btn btn-primary w-full">Test Your Baseline (No Coffee)</button>
                    <button id="start-with-coffee" class="btn btn-primary w-full">Test With "Virtual Coffee"</button>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">Baseline Results (ms):</h3>
                        <ul id="no-coffee-results" class="list-disc list-inside bg-gray-900 p-3 rounded-md min-h-[100px]"></ul>
                        <p class="font-bold mt-2">Average: <span id="no-coffee-avg" class="text-yellow-400">N/A</span></p>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-2">"Virtual Coffee" Results (ms):</h3>
                        <ul id="with-coffee-results" class="list-disc list-inside bg-gray-900 p-3 rounded-md min-h-[100px]"></ul>
                        <p class="font-bold mt-2">Average: <span id="with-coffee-avg" class="text-yellow-400">N/A</span></p>
                    </div>
                </div>
            </div>

            <!-- Step 3: Analysis -->
            <div class="card">
                <h2 class="text-2xl font-bold text-white mb-3">Step 3: Analyze the Results</h2>
                <p class="mb-4">Okay, we see a difference in the averages. But is this difference <strong class="text-yellow-400">statistically significant</strong>, or could it have just happened by random chance? This is where P-Values and Confidence Intervals come in.</p>
                
                <div class="text-center my-6">
                    <button id="analyze-btn" class="btn btn-secondary text-xl px-8 py-4" disabled>Analyze My Data!</button>
                </div>

                <div id="analysis-results" class="hidden space-y-6">
                    <div>
                        <h3 class="text-xl font-bold text-green-400 mb-2">What's a P-Value?</h3>
                        <p>Think of the <strong class="text-green-400">P-value</strong> as a "surprise-o-meter." It's the probability of seeing results like yours (or even more extreme) <strong class="italic">if the Null Hypothesis was actually true</strong> (i.e., if coffee had no effect).</p>
                        <ul class="list-disc list-inside mt-2 ml-4">
                            <li>A <strong class="text-red-400">low p-value</strong> (typically < 0.05) means you're very surprised. Your results are unlikely to be due to chance, so you <strong class="text-red-400">reject the Null Hypothesis</strong>.</li>
                            <li>A <strong class="text-blue-400">high p-value</strong> (>= 0.05) means you're not surprised. The results could easily have happened by chance. You <strong class="text-blue-400">fail to reject the Null Hypothesis</strong>.</li>
                        </ul>
                         <p class="text-2xl font-bold text-center mt-4">Your P-Value: <span id="p-value-display" class="text-yellow-300"></span></p>
                    </div>
                    <hr class="border-gray-600">
                    <div>
                        <h3 class="text-xl font-bold text-blue-400 mb-2">What's a Confidence Interval?</h3>
                        <p>The difference between your two average scores is just a single number. A <strong class="text-blue-400">95% Confidence Interval</strong> gives us a plausible <strong class="italic">range</strong> for the <strong class="italic">true difference</strong> in reaction time for the entire population.</p>
                        <p class="mt-2">The key takeaway: <strong class="text-yellow-400">If the interval does NOT contain zero</strong>, it suggests there's a real difference between the two groups!</p>
                        <p class="text-2xl font-bold text-center mt-4">Your 95% Confidence Interval for the Difference (ms): <span id="ci-display" class="text-yellow-300"></span></p>
                    </div>
                     <hr class="border-gray-600">
                     <div id="final-conclusion" class="bg-gray-900 border border-yellow-500/30 p-6 rounded-lg text-center">
                        <h3 class="text-2xl font-bold text-yellow-400">Conclusion</h3>
                        <p id="conclusion-text" class="text-lg mt-2"></p>
                    </div>
                </div>
            </div>
             <div class="text-center mt-4">
                <button id="reset-btn" class="btn btn-secondary">Reset and Start Over</button>
            </div>
        </main>
    </div>

<script>
// --- DOM Elements ---
const startNoCoffeeBtn = document.getElementById('start-no-coffee');
const startWithCoffeeBtn = document.getElementById('start-with-coffee');
const analyzeBtn = document.getElementById('analyze-btn');
const resetBtn = document.getElementById('reset-btn');

const gameBox = document.getElementById('game-box');
const gameText = document.getElementById('game-text');

const noCoffeeResultsList = document.getElementById('no-coffee-results');
const withCoffeeResultsList = document.getElementById('with-coffee-results');
const noCoffeeAvgDisplay = document.getElementById('no-coffee-avg');
const withCoffeeAvgDisplay = document.getElementById('with-coffee-avg');

const analysisResultsDiv = document.getElementById('analysis-results');
const pValueDisplay = document.getElementById('p-value-display');
const ciDisplay = document.getElementById('ci-display');
const finalConclusionDiv = document.getElementById('final-conclusion');
const conclusionText = document.getElementById('conclusion-text');

// --- Game State ---
let noCoffeeTimes = [];
let withCoffeeTimes = [];
let currentGroup = null; // 'no-coffee' or 'with-coffee'
const TRIALS_PER_GROUP = 5;
let trialsLeft = 0;
let startTime;
let gameTimeout;

// --- Event Listeners ---
startNoCoffeeBtn.addEventListener('click', () => startSeries('no-coffee'));
startWithCoffeeBtn.addEventListener('click', () => startSeries('with-coffee'));
analyzeBtn.addEventListener('click', runAnalysis);
resetBtn.addEventListener('click', resetAll);
gameBox.addEventListener('click', onBoxClick);

// --- Game Logic ---
function startSeries(group) {
    if (trialsLeft > 0) return; // Prevent starting mid-game
    currentGroup = group;
    trialsLeft = TRIALS_PER_GROUP;
    if (group === 'no-coffee') {
        noCoffeeTimes = [];
        noCoffeeResultsList.innerHTML = '';
        noCoffeeAvgDisplay.textContent = 'N/A';
    } else {
        withCoffeeTimes = [];
        withCoffeeResultsList.innerHTML = '';
        withCoffeeAvgDisplay.textContent = 'N/A';
    }
    updateButtonStates();
    gameText.textContent = `Get Ready for Trial 1 of ${TRIALS_PER_GROUP}...`;
    gameBox.style.backgroundColor = '#374151'; // gray-700
    setTimeout(prepareTrial, 1500);
}

function prepareTrial() {
    if (trialsLeft === 0) {
        endSeries();
        return;
    }
    gameText.textContent = `Trial ${TRIALS_PER_GROUP - trialsLeft + 1}: Wait for green...`;
    gameBox.style.backgroundColor = '#B91C1C'; // red-800
    const randomDelay = Math.random() * 2000 + 1000; // 1-3 seconds
    gameTimeout = setTimeout(startTrial, randomDelay);
}

function startTrial() {
    gameBox.style.backgroundColor = '#16A34A'; // green-600
    gameText.textContent = "CLICK NOW!";
    startTime = Date.now();
}

function onBoxClick() {
    if (!startTime) { // Clicked too early
        if (trialsLeft > 0 && currentGroup) {
            clearTimeout(gameTimeout);
            gameText.textContent = "Too soon! Resetting trial...";
            gameBox.style.backgroundColor = '#374151'; // gray-700
            setTimeout(prepareTrial, 2000);
        }
        return;
    }

    const reactionTime = Date.now() - startTime;
    startTime = null;

    let adjustedReactionTime = reactionTime;
    // Let's make the "coffee" have a real, but subtle, effect!
    if (currentGroup === 'with-coffee') {
        adjustedReactionTime = Math.max(50, reactionTime - (Math.random() * 50 + 20)); // 20-70ms faster
    }
    
    const time = Math.round(adjustedReactionTime);

    if (currentGroup === 'no-coffee') {
        noCoffeeTimes.push(time);
        updateResultsList(noCoffeeResultsList, noCoffeeTimes);
    } else {
        withCoffeeTimes.push(time);
        updateResultsList(withCoffeeResultsList, withCoffeeTimes);
    }

    trialsLeft--;
    gameBox.style.backgroundColor = '#374151'; // gray-700
    gameText.textContent = `Nice! ${trialsLeft} trials left.`;
    setTimeout(prepareTrial, 1000);
}

function endSeries() {
    gameText.textContent = 'Data collected! Ready for the next group?';
    if (currentGroup === 'no-coffee') {
        updateAverage(noCoffeeTimes, noCoffeeAvgDisplay);
    } else {
        updateAverage(withCoffeeTimes, withCoffeeAvgDisplay);
    }
    currentGroup = null;
    updateButtonStates();
}

// --- UI Updates ---
function updateResultsList(listElement, timesArray) {
    listElement.innerHTML = timesArray.map(t => `<li>${t} ms</li>`).join('');
}

function updateAverage(timesArray, avgElement) {
    if (timesArray.length > 0) {
        const avg = timesArray.reduce((a, b) => a + b, 0) / timesArray.length;
        avgElement.textContent = `${avg.toFixed(2)} ms`;
    }
}

function updateButtonStates() {
    const isPlaying = trialsLeft > 0;
    startNoCoffeeBtn.disabled = isPlaying;
    startWithCoffeeBtn.disabled = isPlaying;

    if (noCoffeeTimes.length === TRIALS_PER_GROUP && withCoffeeTimes.length === TRIALS_PER_GROUP) {
        analyzeBtn.disabled = false;
        analyzeBtn.classList.remove('btn-secondary');
        analyzeBtn.classList.add('btn-primary');
    } else {
        analyzeBtn.disabled = true;
        analyzeBtn.classList.add('btn-secondary');
        analyzeBtn.classList.remove('btn-primary');
    }
}

function resetAll() {
    noCoffeeTimes = [];
    withCoffeeTimes = [];
    trialsLeft = 0;
    currentGroup = null;
    startTime = null;
    clearTimeout(gameTimeout);

    noCoffeeResultsList.innerHTML = '';
    withCoffeeResultsList.innerHTML = '';
    noCoffeeAvgDisplay.textContent = 'N/A';
    withCoffeeAvgDisplay.textContent = 'N/A';
    
    gameBox.style.backgroundColor = '#374151';
    gameText.textContent = 'Ready to Play?';
    
    analysisResultsDiv.classList.add('hidden');
    updateButtonStates();
}

// --- Statistics Logic ---
function runAnalysis() {
    if (noCoffeeTimes.length < 2 || withCoffeeTimes.length < 2) return;

    const stats = calculateTTest(noCoffeeTimes, withCoffeeTimes);

    pValueDisplay.textContent = stats.pValue.toFixed(4);
    ciDisplay.textContent = `[${stats.ci[0].toFixed(2)}, ${stats.ci[1].toFixed(2)}]`;
    
    // Determine conclusion
    let conclusion = '';
    if (stats.pValue < 0.05) {
        conclusion = `Your P-value is less than 0.05. This is a "surprising" result! We <strong class="text-red-400">reject the Null Hypothesis.</strong> The evidence suggests that "virtual coffee" does have a significant effect on reaction time in your experiment.`;
        if(! (stats.ci[0] < 0 && stats.ci[1] > 0) ) {
            conclusion += ` Furthermore, the 95% Confidence Interval for the difference <strong class="text-red-400">does not contain 0</strong>, which strengthens our conclusion!`;
        }
    } else {
        conclusion = `Your P-value is greater than 0.05. This result isn't statistically "surprising". We <strong class="text-blue-400">fail to reject the Null Hypothesis.</strong> We don't have enough evidence to say that "virtual coffee" had an effect.`;
        if( (stats.ci[0] < 0 && stats.ci[1] > 0) ) {
            conclusion += ` Also note that the 95% Confidence Interval <strong class="text-blue-400">contains 0</strong>, meaning no difference is a plausible outcome.`;
        }
    }
    conclusionText.innerHTML = conclusion;

    analysisResultsDiv.classList.remove('hidden');
    window.scrollTo({ top: analyzeBtn.offsetTop, behavior: 'smooth' });
}


function calculateTTest(sample1, sample2) {
    const mean = arr => arr.reduce((a, b) => a + b, 0) / arr.length;
    const variance = (arr, m) => arr.reduce((a, b) => a + Math.pow(b - m, 2), 0) / (arr.length - 1);

    const n1 = sample1.length;
    const n2 = sample2.length;

    const m1 = mean(sample1);
    const m2 = mean(sample2);

    const v1 = variance(sample1, m1);
    const v2 = variance(sample2, m2);

    // Independent t-test
    const sp = Math.sqrt(((n1 - 1) * v1 + (n2 - 1) * v2) / (n1 + n2 - 2));
    const tStat = (m1 - m2) / (sp * Math.sqrt(1 / n1 + 1 / n2));

    const df = n1 + n2 - 2;

    // A simple approximation for p-value from t-statistic. 
    // This is not perfect but good enough for a demo.
    // A real implementation would use a CDF function.
    const pValue = tDist_p(df, tStat)

    // Calculate confidence interval
    const standardError = sp * Math.sqrt(1 / n1 + 1 / n2);
    const tCrit = 2.262; // t-critical for 95% CI with df=9 (our case is df=8, close enough for demo)
    const marginOfError = tCrit * standardError;
    const diffMean = m1 - m2;
    const ci = [diffMean - marginOfError, diffMean + marginOfError];
    
    return { pValue, tStat, df, ci };
}

// P-value from t-statistic, a rough approximation for demo purposes.
// From https://gist.github.com/dssstr/4733838
function tDist_p(df, t) {
	var x = df/2;
	var a=x-0.5;
	var b=x;
	var p=b/(b+t*t/df);
	var bt=Math.exp(lngamma(a+b)-lngamma(a)-lngamma(b)+a*Math.log(p)+ (b-1)*Math.log(1-p));
	if(t<0) {
		bt=1-bt/2
	} else {
		bt=bt/2;
	}
	return 2*bt;
}

function lngamma(x) {
	var a=[8.333333333333333e-02,-2.777777777777778e-03,7.936507936507937e-04,-5.952380952380952e-04,8.417508417508418e-04,-1.917526917526918e-03,6.410256410256410e-03,-2.955065359477124e-02,1.796443723688307e-01,-1.39243221690590e+00];
	var s=1;
	for(var i=0;i<10;i++) s+=a[i]/++x;
	return Math.log(s*Math.sqrt(2*Math.PI)/x)+(x-0.5)*Math.log(x)-x;
}

</script>

</body>
</html>
